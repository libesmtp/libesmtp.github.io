

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>StartTLS Extension &mdash; libESMTP 1.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Auth Extension" href="smtp-auth.html" />
    <link rel="prev" title="Core API" href="smtp-api.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> libESMTP
          

          
            
            <img src="../../_static/pillarbox.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../libesmtp.html">Benefits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes-since-v1.0.6.html">Changes since v1.0.6</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../programflow.html">API Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../certificates.html">TLS Certificates</a></li>
<li class="toctree-l2"><a class="reference internal" href="libesmtp.html">libESMTP Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html">Core API</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html#delivery-status-notification-dsn">Delivery Status Notification (DSN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html#size-extention">Size Extention</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html#bit-mime-transport-extension">8bit-MIME Transport Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html#deliver-by-extension">Deliver By Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html#id1">Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html#smtp-protocol">SMTP Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html#tear-down-session">Tear Down Session</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html#application-data">Application Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-api.html#miscellaneous-apis">Miscellaneous APIs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">StartTLS Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-auth.html">Auth Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="auth-client.html">Auth Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="message-callbacks.html">Message Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="headers.html">Message Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="smtp-etrn.html">Remote Message Queue Starting (ETRN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../events.html">Event Callback</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tlsevents.html">TLS Event Callback</a></li>
<li class="toctree-l2"><a class="reference internal" href="../licence.html">Licence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../genindex.html">Index of Symbols</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../bugreport.html">Reporting Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../essays.html">Essays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Author</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../oldfiles.html">Legacy Files</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/libesmtp/libESMTP/wiki">Wiki</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">libESMTP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">API Reference</a> &raquo;</li>
        
      <li>StartTLS Extension</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p id="rfc-2487"><strong>RFC 2487</strong></p>
<div class="section" id="starttls-extension">
<h1>StartTLS Extension<a class="headerlink" href="#starttls-extension" title="Permalink to this headline">¶</a></h1>
<p>If OpenSSL is available when building libESMTP, support for the STARTTLS
extension can be enabled.  If support is not enabled, the following APIs
will always fail:</p>
<ul class="simple">
<li><p>smtp_starttls_set_password_cb()</p></li>
<li><p>smtp_starttls_set_ctx()</p></li>
<li><p>smtp_starttls_enable()</p></li>
</ul>
<p>See also: <a class="reference external" href="https://www.openssl.org/">OpenSSL</a>.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.smtp_starttls_set_password_cb">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">smtp_starttls_set_password_cb</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="libesmtp.html#c.smtp_starttls_passwordcb_t" title="smtp_starttls_passwordcb_t"><span class="n"><span class="pre">smtp_starttls_passwordcb_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">cb</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">arg</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.smtp_starttls_set_password_cb" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set OpenSSL password callback.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">smtp_starttls_passwordcb_t</span> <span class="pre">cb</span></code></dt><dd><p>Password callback with signature <a class="reference internal" href="libesmtp.html#c.smtp_starttls_passwordcb_t" title="smtp_starttls_passwordcb_t"><code class="xref c c-type docutils literal notranslate"><span class="pre">smtp_starttls_passwordcb_t</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*arg</span></code></dt><dd><p>User data passed to the callback.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Set password callback function for OpenSSL. Unusually this API does not
require a <code class="xref c c-type docutils literal notranslate"><span class="pre">typedef</span> <span class="pre">smtp_session_t</span></code> as the data it sets is global.</p>
<p>N.B.  If this API is not called and OpenSSL requires a password, it will
supply a default callback which prompts on the user’s tty.  This is likely
to be undesired behaviour, so the app should supply a callback using this
function.</p>
<p><strong>Return</strong></p>
<p>Zero on failure, non-zero on success.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.smtp_starttls_set_ctx">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">smtp_starttls_set_ctx</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">smtp_session_t</span></span><span class="w"> </span><span class="n"><span class="pre">session</span></span>, <span class="n"><span class="pre">SSL_CTX</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.smtp_starttls_set_ctx" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set the SSL_CTX for the SMTP session.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">smtp_session_t</span> <span class="pre">session</span></code></dt><dd><p>The session.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SSL_CTX</span> <span class="pre">*ctx</span></code></dt><dd><p>An SSL_CTX initialised by the application.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Use an SSL_CTX created and initialised by the application. The SSL_CTX is up
referenced by libESMTP and subsequently freed when the session is destroyed.
This means that it is valid for an application to create an SSL_CTX and
immediately free it after passing it to this call.</p>
<p>This call is useful if an application must support older versions of SSL or
TLS than are supported by libESMTP, or if it wishes to impose stricter
conditions on the TLS version to be used for the session.</p>
<p>If this call is not used OpenSSL is automatically initialised before
calling any of the OpenSSL API functions.</p>
<p><strong>Return</strong></p>
<p>Zero on failure, non-zero on success.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.smtp_starttls_enable">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">smtp_starttls_enable</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">smtp_session_t</span></span><span class="w"> </span><span class="n"><span class="pre">session</span></span>, <span class="k"><span class="pre">enum</span></span><span class="w"> </span><a class="reference internal" href="libesmtp.html#c.starttls_option" title="starttls_option"><span class="n"><span class="pre">starttls_option</span></span></a><span class="w"> </span><span class="n"><span class="pre">how</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.smtp_starttls_enable" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Enable STARTTLS verb.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">smtp_session_t</span> <span class="pre">session</span></code></dt><dd><p>The session.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">starttls_option</span> <span class="pre">how</span></code></dt><dd><p>A <a class="reference internal" href="libesmtp.html#c.starttls_option" title="starttls_option"><code class="xref c c-type docutils literal notranslate"><span class="pre">enum</span> <span class="pre">starttls_option</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Enable the SMTP STARTTLS verb if <strong>how</strong> is not <code class="docutils literal notranslate"><span class="pre">Starttls_DISABLED</span></code>.  If set to
<code class="docutils literal notranslate"><span class="pre">Starttls_REQUIRED</span></code> the protocol will quit rather than transferring any
messages if the STARTTLS extension is not available.</p>
<p><strong>Return</strong></p>
<p>Zero on failure, non-zero on success.</p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="smtp-auth.html" class="btn btn-neutral float-right" title="Auth Extension" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="smtp-api.html" class="btn btn-neutral float-left" title="Core API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Brian Stafford.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>