

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>API Overview &mdash; libESMTP 1.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TLS Certificates" href="certificates.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> libESMTP
          

          
            
            <img src="../_static/pillarbox.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../libesmtp.html">Benefits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes-since-v1.0.6.html">Changes since v1.0.6</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">API Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="certificates.html">TLS Certificates</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/libesmtp.html">libESMTP Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html">Core API</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html#delivery-status-notification-dsn">Delivery Status Notification (DSN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html#size-extention">Size Extention</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html#bit-mime-transport-extension">8bit-MIME Transport Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html#deliver-by-extension">Deliver By Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html#id1">Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html#smtp-protocol">SMTP Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html#tear-down-session">Tear Down Session</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html#application-data">Application Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-api.html#miscellaneous-apis">Miscellaneous APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-tls.html">StartTLS Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-auth.html">Auth Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/auth-client.html">Auth Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/message-callbacks.html">Message Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/headers.html">Message Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/smtp-etrn.html">Remote Message Queue Starting (ETRN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="_kdoc/errors.html">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="licence.html">Licence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../genindex.html">Index of Symbols</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bugreport.html">Reporting Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../essays.html">Essays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Author</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oldfiles.html">Legacy Files</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/libesmtp/libESMTP/wiki">Wiki</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">libESMTP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">API Reference</a> &raquo;</li>
        
      <li>API Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="api-overview">
<h1>API Overview<a class="headerlink" href="#api-overview" title="Permalink to this headline">¶</a></h1>
<p>A libESMTP application should be structured similarly to the following.
Declarations, function arguments and other details are omitted for clarity.</p>
<p>A working, fully commented, example application may be found in
<code class="docutils literal notranslate"><span class="pre">examples/mail-file.c</span></code> in the distribution.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">libesmtp_application</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="cm">/* Create the libESMTP session */</span>
  <span class="n">session</span> <span class="o">=</span> <span class="n">smtp_create_session</span> <span class="p">();</span>

  <span class="cm">/* Add a message. */</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">smtp_add_message</span> <span class="p">(</span><span class="n">session</span><span class="p">);</span>

  <span class="cm">/* Add recipients to the message. */</span>
  <span class="k">while</span> <span class="p">((</span><span class="n">address</span> <span class="o">=</span> <span class="n">get_recipient</span> <span class="p">())</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">recipient</span> <span class="o">=</span> <span class="n">smtp_add_recipient</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">address</span><span class="p">);</span>

      <span class="cm">/* set a recipient option, e.g. to request a DSN if anything fails */</span>
      <span class="n">smtp_dsn_set_notify</span> <span class="p">(</span><span class="n">recipient</span><span class="p">,</span> <span class="n">Notify_DELAY</span> <span class="o">|</span> <span class="n">Notify_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="cm">/* A callback to read the message from the application is required */</span>
  <span class="n">smtp_set_messagecb</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">message_cb</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>

  <span class="cm">/* Add a header in case the application does not supply one via the</span>
<span class="cm">     message callback */</span>
  <span class="n">smtp_set_header</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;To&quot;</span><span class="p">,</span> <span class="s">&quot;Joe Bloggs&quot;</span><span class="p">,</span> <span class="s">&quot;joe.bloggs@example.org&quot;</span><span class="p">);</span>

  <span class="cm">/* Use TLS to secure the session */</span>
  <span class="n">smtp_starttls_enable</span> <span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">Starttls_REQUIRED</span><span class="p">);</span>

  <span class="cm">/* Set the submission host (aka smarthost) */</span>
  <span class="n">smtp_set_server</span> <span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s">&quot;msa.example.org:587&quot;</span><span class="p">);</span>

  <span class="cm">/* set an event callback and start the session */</span>
  <span class="n">smtp_set_eventcb</span> <span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">smtp_start_session</span> <span class="p">(</span><span class="n">session</span><span class="p">);</span>

  <span class="cm">/* tear down the session */</span>
  <span class="n">smtp_destroy_session</span> <span class="p">(</span><span class="n">session</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Some points to note are that multiple messages may be added to a session and
each message may have multiple recipients.</p>
<p>The event callback <code class="docutils literal notranslate"><span class="pre">event_cb</span></code> is called as the SMTP protocol progresses and the
message callback <code class="docutils literal notranslate"><span class="pre">message_cb</span></code> is used to read the message from the application.</p>
<p><code class="docutils literal notranslate"><span class="pre">smtp_start_session()</span></code> returns an error code if anything fails, however take
note that it returns successfully if the SMTP protocol progresses correctly,
even if the server refuses messages or recipients, for example if a message is
too large or it cannot deliver to a particular recipient, libESMTP still
considers that the protocol operated correctly.  It is necessary to use the
event callback to determine if messages or recipients are refused by the
server. Alternatively it is possible to enumerate the messages and recipients
to examine the status codes if <code class="docutils literal notranslate"><span class="pre">smtp_start_session()</span></code> returns successfully.</p>
<p>The message callback should supply a properly formatted RFC 5322 message, that
is headers followed by a blank line followed by the message body.  Each line
<em>must</em> be terminated with a CR-LF, CR or LF on its own will not be recognised.
If the application supplies no headers and relies on libESMTP it must still
precede the message with a blank line.</p>
<p>The message recipients listed in the ‘To:’, ‘Cc:’ and ‘Bcc:’ message headers
need not correspond to those specified in the SMTP protocol using the RCPT TO
verb. Similarly the ‘From:’ message header need not correspond to that
specified in the MAIL FROM verb. This might occur if the message has been
distributed through mailing list software.</p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="certificates.html" class="btn btn-neutral float-right" title="TLS Certificates" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Brian Stafford.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>